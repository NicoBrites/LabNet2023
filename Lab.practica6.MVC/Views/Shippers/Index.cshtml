@model List<Lab.Practica3.EF.Entities.Dto.ShippersDto>
@{
    ViewBag.Title = "Shippers PAGE";
}

<h1>Lista de Shippers</h1>
<hr style="color: #0056b2;" />

<table class="table">
    <thead>
        <tr>
            <th scope="col">Id Shipper</th>
            <th scope="col">CompanyName</th>
            <th scope="col">Phone</th>
            <th scope="col">Borrar</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var shipper in Model)
        {
            <tr>
                <th scope="row">@shipper.ShipperID</th>
                <td>@shipper.CompanyName</td>
                <td>@shipper.Phone</td>
                <td>
                    <button id="borrar" onclick="deleteShipper(@shipper.ShipperID)">Borrar</button>

                    @Html.ActionLink("Borrar", "DeleteShipper", new { id = shipper.ShipperID }, new { onclick = "return confirm('Estas seguro de borrar ?')" })
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts{
    <script type="text/javascript" charset="utf-8">

        function deleteShipper(ShipperID) {
            Swal.fire({
                title: '¿Está seguro?',
                text: "No podrás revertir esta operación!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: 'Cancelar',
                confirmButtonText: 'Si, Eliminar!',
            }).then((result) => {
                if (result.isConfirmed) {
                    confirmDelete(ShipperID);
                }
            });
        }
        function confirmDelete(ShipperID) {
            $.ajax({
                url: '@Url.Action("DeleteShipper", "Shippers")/' + ShipperID,
                method: 'POST',
                dataType: "json",
                success: function (data) {
                    if (data.result)
                    {
                        Swal.fire({
                            title: 'Bien!',
                            text: 'Shipper eliminado!',
                            icon: 'success',
                            confirmButtonText: 'OK',
                        }).then((result) => {
                            if (result.isConfirmed) {
                                window.location.reload();
                            }
                        });
                    } else {
                        Swal.fire(
                            'Error!',
                            'No se pudo eliminar, por favor volver a intentar!',
                            'error'
                        );
                    }
                    console.log(data);
                },
                error: function (xhr, textStatus, errorThrown) {
                    console.error(xhr);
                }
            });
        }

    </script>
}